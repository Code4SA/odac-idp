<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}iNeighbourhood demo{% endblock %}</title>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/styles.css">

    {% block head %}
    {% endblock %}
</head>
<body>

<div id="page-container" class="container">
    {% block page %}
    <div class="row">
        <img src="/static/images/ineighbourhood.png" />
        <p id="tagline" class="lead">
            What is the government planning near you?
        </p>
        <hr>
        <div class="alert alert-info alert-dismissable">
            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
            This is only a demo application. The data that is shown may be incomplete, or out of date
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6">
            <div class="row">
                <div class="col-lg-8">
                    <div id="ward-title">
                        <p class="lead" style="padding-top: 50px;">
                            Select your ward on the map to see what's going on.
                        </p>
                    </div>
                    <ul class="list-unstyled" id="ward-info">
                    </ul>
                </div>
                <div class="col-lg-4">
                    <div id="profile-pic" class="text-center">

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div id="ward-description">

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div id="project-list">

                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div id="map-container" class="pull-left">
            </div>
        </div>
    </div>

    {% endblock %}
</div>

{% block page_footer %}
<div class="container" id="footer">
    <div class="col-lg-12 text-center">
        <hr>
        <a class="tiny-logo" href="http://www.code4sa.org/"><img id="logo-code4sa" src="/static/images/code4sa-logo-small.png"></a>
        <a class="tiny-logo" href="http://www.opendemocracy.org.za/"><img id="logo-odac" src="/static/images/odac-logo-small.gif"></a>
        <p id="copyright"><small>Copyright &copy; Open Democracy Advice Centre 2014</small></p>
    </div>
</div>
{% endblock %}

</body>
<script src="//code.jquery.com/jquery-2.0.3.min.js" type="text/javascript"></script>
<script src="//code.jquery.com/ui/1.10.3/jquery-ui.js" type="text/javascript"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script src="/static/capesean-mapper/mapper.js" type="text/javascript"></script>
<script src="/static/ward-info.js" type="text/javascript"></script>
{% block javascript %}
<script>

    function list_projects(data){
        var project_list = $("#project-list")
        project_list.html("<h4>City council projects</h4>")
        for (var i = 0; i < data.length; i++)
        {
            var item = '<div class="project-item">' +
                    '<strong class="pull-right">' + data[i].cost + '</strong>' +
                    data[i].name + " (" + data[i].department + ")<br>" +
                    data[i].description +
                    "</div>"
            project_list.append(item)
        }
    }

    function show_councillor(data){
        var profile_pic = $("#profile-pic")
        var tmp = '<img class="profile-pic" src="static/councillors/' + data.image + '">'
        profile_pic.html(tmp)

        var info = $("#ward-info")
        var tmp = '<li><strong>Councillor ' + data.name + ' (' + data.party + ')</strong></li>'
        if(data.cellphone)
            tmp += '<li><strong>Telephone:</strong> ' + data.cellphone + '</li>'
        if(data.address)
            tmp += '<li><strong>Address:</strong> ' + data.address + '</li>'
        if(data.email)
            tmp += '<li><strong>Email:</strong> ' + data.email + '</li>'

        info.html(tmp)
    }

    $(document).ready(function(){

        $("#map-container").mapper({
            dataType: "wards",
            drawAll: false,
            data: wards,
            province: "Western Cape",
            click: function (event) {
                var tmp = "<h3>Ward No. " + this.ward_no + "</h3>"
                $("#ward-title").html(tmp)
                var tmp = '<h4>Area description</h4>' +
                        "<p>" + this.description + "</p>"
                $("#ward-description").html(tmp)

                tmp = $.getJSON("/" + this.id + "/", function(data){
                    list_projects(data.projects)
                    show_councillor(data.councillor)
                })
            }
        })
    });
</script>
{% endblock %}
</html>